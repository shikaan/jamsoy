<html>

<head>
  <title>JamSoy - GameBoy Emulator</title>
  <style>
    canvas {
      border: 1px solid black;
      image-rendering: pixelated;
      width: 320px;
      height: 288px;
    }
  </style>
</head>

<body>
  <h1>JamSoy - GameBoy Emulator</h1>
  <h2 id="title"></h2>
  <input type="file" id="rom" accept=".gb" />
  <canvas id="screen" width="160" height="144"></canvas>
  <script type="module">
    import { getMetadata } from '../lib/cartridge.mjs';
    import { GameBoy } from '../lib/gameboy.mjs';

    const $rom = document.getElementById('rom');
    const $title = document.getElementById('title');
    const $screen = document.getElementById('screen');

    const gameboy = new GameBoy($screen);

    const loop = () => {
      requestAnimationFrame(() => {
        gameboy.update();
        loop();
      })
    }

    $rom.addEventListener('change', async (event) => {
      const file = event.target.files[0];
      const buffer = await file.arrayBuffer();
      const rom = new Uint8Array(buffer);
      const metadata = getMetadata(rom);

      $title.textContent = metadata.title;

      gameboy.loadROM(rom);
      loop()
    });
  </script>
</body>

</html>